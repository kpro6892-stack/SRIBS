// SBRI Slot Editor - Single-file React component // Default export: SlotEditor // Tailwind CSS is required in the hosting app. // Dependencies (install in your project): // npm install html2canvas jspdf // Or include cdn versions in index.html for quick test.

import React, { useState, useRef } from "react"; import html2canvas from "html2canvas"; import jsPDF from "jspdf";

// Configuration: days and period labels const DAYS = ["MON","TUE","WED","THU","FRI","SAT","SUN"]; const PERIOD_LABELS = [ "08:00–08:50 (P1)", "09:00–09:50 (P2)", "10:00–10:50 (P3)", "11:00–11:50 (P4)", "12:00–12:50 (P5)", "12:50–13:20 (EXT)", "14:00–14:50 (E1)", "15:00–15:50 (E2)", "16:00–16:50 (E3)", "17:00–17:50 (E4)", "18:00–18:50 (E5)", "19:00–19:50 (E6)", ];

// Utility: build slot codes (A1..A12, B1..B12, ... G1..G12) const buildSlotMatrix = () => { const letters = ["A","B","C","D","E","F","G"]; // Mon..Sun const matrix = {}; for (let d = 0; d < DAYS.length; d++) { const row = []; for (let p = 0; p < PERIOD_LABELS.length; p++) { row.push(${letters[d]}${p+1}); } matrix[DAYS[d]] = row; } return matrix; };

// Default empty content for each cell: shows slot code and (Empty) const buildDefaultGrid = () => { const slots = buildSlotMatrix(); const grid = {}; DAYS.forEach((day) => { grid[day] = slots[day].map((slot) => ({ slot, content: "", room: "", faculty: "", isLab: false, needsExt: false, })); }); return grid; };

export default function SlotEditor() { const [grid, setGrid] = useState(() => buildDefaultGrid()); const [selected, setSelected] = useState(null); // {day, idx} const [search, setSearch] = useState(""); const canvasRef = useRef();

// Edit handler function openEditor(day, idx) { setSelected({day, idx}); }

function closeEditor() { setSelected(null); }

function saveCell(data) { setGrid((prev) => { const copy = {...prev}; copy[data.day] = [...copy[data.day]]; copy[data.day][data.idx] = { ...copy[data.day][data.idx], content: data.content, room: data.room, faculty: data.faculty, isLab: data.isLab, needsExt: data.needsExt, }; return copy; }); closeEditor(); }

function clearCell(day, idx) { setGrid((prev) => { const copy = {...prev}; copy[day] = [...copy[day]]; copy[day][idx] = {...copy[day][idx], content:'', room:'', faculty:'', isLab:false, needsExt:false}; return copy; }); }

// Bulk download as PDF of current grid (single dept view or all pages) async function downloadPDF(filename="SBRI_Timetable.pdf") { // Render the DOM node referenced by canvasRef const node = canvasRef.current; if (!node) return; // use html2canvas with high scale const canvas = await html2canvas(node, {scale: 2, useCORS: true}); const imgData = canvas.toDataURL('image/png'); const pdf = new jsPDF({orientation: 'landscape', unit: 'pt', format: 'a4'}); // calculate dimensions to fit A4 landscape (in points) const pageWidth = pdf.internal.pageSize.getWidth(); const pageHeight = pdf.internal.pageSize.getHeight(); // draw the image scaled const imgProps = pdf.getImageProperties(imgData); const imgWidth = pageWidth - 40; // margin const imgHeight = (imgProps.height * imgWidth) / imgProps.width; pdf.addImage(imgData, 'PNG', 20, 20, imgWidth, imgHeight); pdf.save(filename); }

// Export CSV function exportCSV(filename="SBRI_Timetable.csv") { const rows = []; rows.push(["Day","Slot","Period","Start","End","Content","Room","Faculty","IsLab","NeedsEXT"]); const periodTimes = [ ["08:00","08:50"],["09:00","09:50"],["10:00","10:50"],["11:00","11:50"], ["12:00","12:50"],["12:50","13:20"],["14:00","14:50"],["15:00","15:50"], ["16:00","16:50"],["17:00","17:50"],["18:00","18:50"],["19:00","19:50"], ]; DAYS.forEach((day) => { grid[day].forEach((cell, idx) => { const period = PERIOD_LABELS[idx]; const [start,end] = periodTimes[idx]; rows.push([day, cell.slot, period, start, end, cell.content || "", cell.room || "", cell.faculty || "", cell.isLab ? "Yes" : "No", cell.needsExt ? "Yes" : "No"]); }); }); const csvContent = rows.map(r => r.map(c => "${String(c).replace(/"/g,'""')}").join(',')).join('\n'); const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url); }

// Quick auto-fill sample data — creates a demo schedule for the selected department function autofillDemo() { // simple deterministic demo fill: place "THEORY" in P1/P4 etc and labs in P4/P5/EXT for some days setGrid((prev) => { const copy = {...prev}; DAYS.forEach((day, dIdx) => { copy[day] = copy[day].map((cell, pIdx) => ({...cell})); // put demo theory at first 7 theory slots if (dIdx < 5) { // assign a demo subject in P1 (idx0) and P8 (idx6) if (copy[day][0]) { copy[day][0].content = DEMO${dIdx+1} - Theory; copy[day][0].room = HAB-${200 + dIdx}; copy[day][0].faculty = Dr. Demo ${dIdx+1}; } if (copy[day][6]) { copy[day][6].content = DEMO${dIdx+1} - Theory (E); copy[day][6].room = HAB-${210 + dIdx}; copy[day][6].faculty = Dr. Demo ${dIdx+1}; } } }); // place a lab for MON at P4/P5/EXT copy['MON'][3].content = 'MBG11L1 - Molecular Techniques Lab'; copy['MON'][3].room = 'HAB-L1'; copy['MON'][3].faculty = 'Dr. Srinidhi'; copy['MON'][3].isLab = true; copy['MON'][3].needsExt = true; copy['MON'][4].content = 'Lab Continues'; copy['MON'][4].isLab = true; copy['MON'][5].content = 'EXT'; copy['MON'][5].isLab = true; return copy; }); }

// search helper const filteredDays = DAYS;

return ( <div className="p-4 bg-gray-50 min-h-screen"> <div className="max-w-7xl mx-auto"> <header className="flex items-center justify-between mb-4"> <h1 className="text-2xl font-bold">SBRI Slot Editor</h1> <div className="flex gap-2"> <button onClick={() => autofillDemo()} className="px-3 py-2 bg-indigo-600 text-white rounded">Autofill Demo</button> <button onClick={() => exportCSV()} className="px-3 py-2 bg-green-600 text-white rounded">Export CSV</button> <button onClick={() => downloadPDF()} className="px-3 py-2 bg-rose-600 text-white rounded">Download PDF</button> </div> </header>

<div className="mb-2 flex items-center gap-2">
      <input value={search} onChange={(e)=>setSearch(e.target.value)} placeholder="Search course/room/faculty" className="border px-2 py-1 rounded w-96" />
      <div className="text-sm text-gray-600">Click any cell to edit. Empty cells show slot code.</div>
    </div>

    {/* Timetable grid container for screenshot */}
    <div ref={canvasRef} className="bg-white shadow p-4 rounded">
      <table className="table-fixed w-full border-collapse">
        <thead>
          <tr>
            <th className="border p-2 bg-gray-100 text-left w-28">Day / Time</th>
            {PERIOD_LABELS.map((pl, i) => (
              <th key={i} className="border p-2 text-center bg-gray-100 text-xs">{pl}</th>
            ))}
          </tr>
        </thead>
        <tbody>
          {filteredDays.map((day) => (
            <tr key={day} className="align-top">
              <td className="border p-1 font-semibold">{day}</td>
              {grid[day].map((cell, idx) => {
                const isMatched = search.length>0 && ((cell.content||"").toLowerCase().includes(search.toLowerCase()) || (cell.room||"").toLowerCase().includes(search.toLowerCase()) || (cell.faculty||"").toLowerCase().includes(search.toLowerCase()));
                return (
                  <td key={idx} onClick={()=>openEditor(day, idx)} className={`border p-2 align-top text-xs cursor-pointer ${cell.isLab? 'bg-pink-100' : (cell.content? 'bg-green-50':'bg-white')} ${isMatched? 'ring-2 ring-indigo-300':''}`}>
                    <div className="text-center font-bold text-sm">{cell.slot}</div>
                    {cell.content ? (
                      <div className="mt-1 text-[10px] leading-tight">
                        <div className="font-semibold">{cell.content}</div>
                        <div className="text-[9px]">{cell.room}</div>
                        <div className="text-[9px]">{cell.faculty}</div>
                        {cell.isLab && <div className="text-[9px] italic">{cell.needsExt? 'EXT' : 'No EXT'}</div>}
                      </div>
                    ) : (
                      <div className="mt-1 text-[10px] text-gray-400">(Empty)</div>
                    )}
                  </td>
                );
              })}
            </tr>
          ))}
        </tbody>
      </table>
    </div>

    {/* Editor modal */}
    {selected && (
      <EditorModal
        day={selected.day}
        idx={selected.idx}
        cell={grid[selected.day][selected.idx]}
        onClose={closeEditor}
        onSave={(payload)=>saveCell(payload)}
        onClear={()=>{clearCell(selected.day, selected.idx); closeEditor();}}
      />
    )}

    <footer className="mt-4 text-sm text-gray-600">Tip: Click a cell to modify slot contents. Use Download PDF to save the grid as a printable A4 landscape.</footer>
  </div>
</div>

); }

function EditorModal({day, idx, cell, onClose, onSave, onClear}){ const [content, setContent] = useState(cell.content||""); const [room, setRoom] = useState(cell.room||""); const [faculty, setFaculty] = useState(cell.faculty||""); const [isLab, setIsLab] = useState(!!cell.isLab); const [needsExt, setNeedsExt] = useState(!!cell.needsExt);

function handleSave(){ onSave({day, idx, content, room, faculty, isLab, needsExt}); }

return ( <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40"> <div className="bg-white rounded shadow p-4 w-[560px]"> <h3 className="text-lg font-bold">Edit Slot: {cell.slot} — {day}</h3> <div className="mt-3 grid grid-cols-1 gap-2"> <label className="text-sm">Course / Content</label> <input value={content} onChange={(e)=>setContent(e.target.value)} className="border p-2 rounded w-full text-sm" /> <div className="grid grid-cols-2 gap-2"> <div> <label className="text-sm">Room</label> <input value={room} onChange={(e)=>setRoom(e.target.value)} className="border p-2 rounded w-full text-sm" /> </div> <div> <label className="text-sm">Faculty</label> <input value={faculty} onChange={(e)=>setFaculty(e.target.value)} className="border p-2 rounded w-full text-sm" /> </div> </div> <div className="flex items-center gap-4 mt-2"> <label className="flex items-center gap-2"><input type="checkbox" checked={isLab} onChange={(e)=>setIsLab(e.target.checked)} /> Is Lab</label> <label className="flex items-center gap-2"><input type="checkbox" checked={needsExt} onChange={(e)=>setNeedsExt(e.target.checked)} /> Needs EXT</label> </div> </div> <div className="mt-4 flex justify-end gap-2"> <button onClick={onClear} className="px-3 py-2 bg-red-600 text-white rounded">Clear</button> <button onClick={onClose} className="px-3 py-2 bg-gray-200 rounded">Cancel</button> <button onClick={handleSave} className="px-3 py-2 bg-indigo-600 text-white rounded">Save</button> </div> </div> </div> ); }

// End of file
